<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Etsy Code Test::Rebecca Miller-Webster</title>
		<meta name="author" content="Rebecca Miller-Webster" />
		<!-- Date: 2012-03-26 -->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script type="text/javascript" src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
		<script type="text/javascript" src="js/etsy.js"></script>
		<script type="application/javascript">
			(function($) {

				$(document).ready(function() {
					$('#etsy-shop').bind('submit', function(e) {
						var shop_id = $('#etsy-shop-name').val();
						$('#etsy-images').empty();
						$('<p>Analyzing ' + shop_id + '</p>').appendTo('#etsy-images');
						ETSY.getActiveListings(shop_id);
						return false;
					});
					
					$('#etsy-search').bind('submit', function() {
						api_key = "xz9zew66bdm4w6mnd4ht1osp";
						terms = $('#etsy-terms').val();
						etsyURL = "http://openapi.etsy.com/v2/listings/active.js?keywords=" + terms + "&limit=12&includes=Images:1&api_key=" + api_key;

						$('#etsy-images').empty();
						$('<p>Searching for ' + terms + '</p>').appendTo('#etsy-images');

						$.ajax({
							url : etsyURL,
							dataType : 'jsonp',
							success : function(data) {
								if(data.ok) {
									$('#etsy-images').empty();
									if(data.count > 0) {
										$.each(data.results, function(i, item) {
											$("<img/>").attr("src", item.Images[0].url_75x75).appendTo("#etsy-images").wrap("<a href='" + item.url + "'></a>");
											if(i % 4 == 3) {
												$('<br/>').appendTo('#etsy-images');
											}
										});
									} else {
										$('<p>No results.</p>').appendTo('#etsy-images');
									}
								} else {
									$('#etsy-images').empty();
									alert(data.error);
								}
							}
						});

						return false;
					})
				});
			})(jQuery);

		</script>
	</head>
	<body>
		<form id="etsy-search">
			<input id="etsy-terms" size="32">
			<button>
				Search!
			</button>
		</form>
		<div id="etsy-images"></div>
		<form id="etsy-shop">
			<input id="etsy-shop-name" size="32" />
			<button>
				Analyze Shop
			</button>
		</form>
	</body>
</html>
